# frozen_string_literal: true

# THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
# RUN `rake generate_all` TO REGENERATE.

# --> git/commit_message_too_long/Dangerfile:
git
  .commits
  .select { |commit| commit.message.split(/\n/).first.length > 50 }
  .each do |commit|
    warn heredoc(
      <<~TEXT
        The commit #{commit.sha} `#{commit.message}` is too long. Please adhere \
        to the following basic structural rules for creating a meaningful \
        commit message:        * Keep the first line of your commit message short (not more than 50 chars). \
          Many tools such as Github and graphical git clients strip the subject after \
          50 characters, and people working on the command line are better off with \
          text which is not too wide.
        * Keep the second line empty
        * Use the rest of the commit message to describe the commit. Thereâ€™s no \
          restriction on the format nor the length, so be as descriptive and \
          informative as possible.
      TEXT
    )
  end

# --> git/fixup_commit/Dangerfile:
git
  .commits
  .select { |commit| commit.message =~ /^fixup! / }
  .each do |commit|
    warn "The commit #{commit.sha} `#{commit.message}` is a fixup commit. " \
      'Please squash your commits before merging.'
  end

# --> git/master_merge_commit/Dangerfile:
if git.commits.any? { |commit| commit.message =~ /^Merge branch 'master'/ }
  warn 'Please rebase to get rid of the merge commits in this PR'
end

# --> git/wip_commit/Dangerfile:
git
  .commits
  .select { |commit| commit.message =~ /\bWIP\b/ }
  .each do |commit|
    warn "The commit #{commit.sha} `#{commit.message}` is a WIP commit. " \
     'Please cleanup your git history before merging.'
  end

# --> lib/heredoc.rb:
def heredoc(text)
  text.gsub(/ +/, ' ')
end

# --> merge_request/issue_reference/Dangerfile:
unless gitlab.mr_body =~ %r{/issues/\d+} || gitlab.mr_body =~ /#\d+/
  warn heredoc(
    <<~TEXT
      This merge request does not reference any issues. Please add an \
      issue reference to the Description.
    TEXT
  )
end
